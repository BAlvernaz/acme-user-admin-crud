<html>
  <head>
<style>
  #navbar {
    display: flex;
    justify-content: space-around;
  }

  form {
    display: flex;
    flex-direction: column;
  }
</style>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/react-router-dom/5.0.0/react-router-dom.js'></script>
  <script>
      function DB(key){
        this.key = key;
      }

      DB.prototype = {
        delay: () => {
          return new Promise((res)=> {
            setTimeout(()=> {
              res();
            }, Math.random()*100)
          });
        },
        storage: window.localStorage,
        byId: function(id){
          return this.read()
            .then( items => items.find( item => item.id === id));
        },
        read: function(){
          return new Promise((resolve, reject)=> {
            const data = this.storage.getItem(this.key);
            if(!data){
              return this.delay().then(()=> resolve([]));
            }
            try{
              const parsed = JSON.parse(data);
              if(!Array.isArray(parsed)){
                return resolve([]);
              }
              this.delay().then(()=> resolve(parsed));
            }
            catch(ex){
              resolve([]);
            }
          });
        },
        create: function(item){
          return new Promise((resolve, reject)=> {
            this.read()
              .then( items => {
                const id = Math.random().toString().slice(2);
                const _item = Object.assign({}, item, { id });
                items.push(_item)
                this.storage.setItem(this.key, JSON.stringify(items))
                this.delay().then(() => resolve(_item));
              });
          });
        },
        update: function(item){
          return new Promise((resolve, reject)=> {
            this.read()
              .then( items => {
                const _items = items.map(_item => {
                  if(_item.id === item.id){
                    return item;
                  }
                  return _item;
                });
                this.storage.setItem(this.key, JSON.stringify(_items));
                this.delay().then(()=> resolve(item));
              });
          });
        },
        clear: function(){
          return new Promise((resolve, reject)=> {
            this.storage.removeItem(this.key);
            resolve();

          });

        },
        destroy: function(item){
          return new Promise((resolve, reject)=> {
            this.read()
              .then( items => {
                const _items = items.filter(_item => {
                  return _item.id !== item.id;
                });
                this.storage.setItem(this.key, JSON.stringify(_items));
                resolve();
              });
          });
        },
      };
  </script>
  </head>
  <body>
    <div id='root'></div>
    <script type='text/babel'>
      const root = document.querySelector('#root');
      const db = new DB('users');
      const { HashRouter, Link, Route} = ReactRouterDOM

      const Navbar = props => {
        return (
          <div id="navbar">
           <Link to="/">Home</Link>
           <Link to="/users">Users</Link>
          </div>
        )
      }

      const Home = () => {
        return <h1>Home</h1>
      }

      const Create = () => {
        return(
          <div>
          <div>
          <h1>Create User</h1>
          </div>
          <div id="formConatiner">
            <form>
              <label htmlFor="newUser">New User:
              <input type="text" name="newUser" />
              </label>
              <label htmlFor="admin"> isAdmin:
              <input type="checkbox" name='admin' id="checkbox" />
              </label>
              <button type="submit">Create User</button>
            </form>

          </div>
          </div>
        )
      }

      class Users extends React.Component {
        render() {
          return (
            <div>
              <div>
              <h1>Users</h1>
              </div>
              <Create />
            </div>
          )
        }
      }

      class App extends React.Component{
        constructor(){
          super();
          this.state = {
            users: {}
          }
        }
        componentDidMount(){
          db.read()
            .then(users => this.setState({ users }))
        }
        render(){
          console.log(this.state)
          return(
            <HashRouter>
            <div>
              <Navbar />
              <Route exact path="/" component={ Home }/>
              <Route path="/users" component= { Users } />
            </div>
            </HashRouter>
          );
        }
      }


      ReactDOM.render(<App />, root);
    </script>
  </body>
</html>
